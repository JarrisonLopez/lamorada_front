<section class="box" *ngIf="!loading; else load">
  <h2>Gestionar disponibilidad</h2>

  <p *ngIf="msg" class="banner ok">{{ msg }}</p>
  <p *ngIf="err" class="banner err">{{ err }}</p>

  <div class="card">
    <h3>Días</h3>
    <div class="days">
      <button
        type="button"
        *ngFor="let d of weekdays"
        (click)="toggleDay(d)"
        [class.active]="form.controls.days.value.includes(d)"
      >
        {{ dayLabel(d) | titlecase }}
      </button>
    </div>

    <h3>Intervalos</h3>
    <div class="row" (keydown.enter)="addSlot()">
      <label
        >Desde
        <input type="time" [formControl]="form.controls.start" />
      </label>
      <label
        >Hasta
        <input type="time" [formControl]="form.controls.end" />
      </label>
      <button type="button" class="flat" (click)="addSlot()">Añadir intervalo</button>
      <span class="helper">Tip: presiona <strong>Enter</strong> para añadir</span>
    </div>

    <div class="presets">
      <span class="helper">Plantillas rápidas:</span>
      <button class="pchip" type="button" (click)="addPreset('08:00', '12:00')">08:00–12:00</button>
      <button class="pchip" type="button" (click)="addPreset('14:00', '18:00')">14:00–18:00</button>
      <button class="pchip" type="button" (click)="addPreset('08:00', '16:00')">
        Jornada (08–16)
      </button>
      <button class="pchip" type="button" (click)="addPreset('09:00', '17:00')">
        Oficina (09–17)
      </button>
      <button class="pchip" type="button" (click)="addPreset('00:00', '23:59')">Todo el día</button>
      <button class="pchip" type="button" (click)="clearSlots()">Limpiar</button>
    </div>

    <ul class="slots">
      <li class="slot" *ngFor="let s of slots; let i = index">
        <strong>{{ s.start }}</strong> – <strong>{{ s.end }}</strong>
        <button type="button" (click)="removeSlot(i)">x</button>
      </li>
    </ul>

    <div class="actions">
      <button type="button" (click)="save()" [disabled]="saving">Guardar</button>
      <button type="button" class="danger" (click)="deleteAll()">Eliminar disponibilidad</button>
    </div>

    <div class="preview" *ngIf="previewBars.length">
      <h4>Vista previa semanal</h4>
      <div class="week">
        <ng-container *ngFor="let r of previewBars">
          <div class="roww">
            <div class="dayname">{{ r.label }}</div>
            <div class="bar">
              <div
                class="fill"
                *ngFor="let b of r.bars"
                [style.left.%]="b.left"
                [style.width.%]="b.width"
              ></div>
            </div>
          </div>
        </ng-container>
      </div>
    </div>
  </div>
</section>

<ng-template #load>
  <div class="box">Cargando…</div>
</ng-template>
