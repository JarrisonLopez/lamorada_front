<section class="page">
  <header class="hero card">
    <div>
      <h2>Agendar cita</h2>
      <div class="muted">Selecciona fecha y hora exacta (en punto o cada 15 min).</div>
    </div>
  </header>

  <p *ngIf="err" class="msg err">{{ err }}</p>
  <p *ngIf="msg" class="msg ok">{{ msg }}</p>

  <form class="card form" [formGroup]="form" (ngSubmit)="submit()">
    <div class="row">
      <label class="field">
        <span>Fecha</span>
        <input type="date" formControlName="date" [min]="minDate" />
      </label>

      <label class="field">
        <span>Hora (en punto)</span>
        <input type="time" formControlName="time" step="900" [min]="minTime" />
      </label>
    </div>

    <label class="field">
      <span>Psicólogo</span>
      <select formControlName="psychologist_id">
        <option value="" disabled>Selecciona…</option>
        <option *ngFor="let p of psychologists" [value]="p._id">{{ p.name }}</option>
      </select>
    </label>

    <label class="field" *ngIf="role === 'psychologist'">
      <span>Paciente</span>
      <select formControlName="patient_id">
        <option value="" disabled>Selecciona…</option>
        <option *ngFor="let u of patients" [value]="u._id">{{ u.name }}</option>
      </select>
    </label>

    <label class="field">
      <span>Notas (opcional)</span>
      <textarea formControlName="notes" rows="3" placeholder="Observaciones…"></textarea>
    </label>

    <div class="actions">
      <button class="btn primary" type="submit" [disabled]="loading || form.invalid">
        {{ loading ? 'Creando…' : 'Crear cita' }}
      </button>
    </div>
  </form>
</section>
