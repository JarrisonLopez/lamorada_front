<section class="wrap">
  <h2>Métodos de pago</h2>

  <div class="grid">
    <!-- Lista -->
    <div class="card">
      <h3>Guardados</h3>
      <div *ngIf="loading">Cargando…</div>

      <ul class="list" *ngIf="!loading && cards.length">
        <li *ngFor="let c of cards">
          <div class="info">
            <div class="title">{{ mask(c.card_number) }}</div>
            <div class="meta">
              <span>{{ c.card_name }}</span>
              <span>Vence: {{ c.expiration_date }}</span>
            </div>
          </div>
          <button class="btn danger" (click)="remove(c._id)" [disabled]="deletingId===c._id">
            {{ deletingId===c._id ? 'Eliminando…' : 'Eliminar' }}
          </button>
        </li>
      </ul>

      <div *ngIf="!loading && !cards.length" class="empty">No tienes tarjetas guardadas.</div>
    </div>

    <!-- Form -->
    <div class="card">
      <h3>Añadir tarjeta</h3>

      <form [formGroup]="form" (ngSubmit)="submit()" novalidate>
        <div class="row">
          <label>Número de tarjeta
            <input type="text" inputmode="numeric" formControlName="card_number" placeholder="4111111111111111" />
          </label>
          <span class="err" *ngIf="form.controls['card_number'].touched && form.controls['card_number'].invalid">
            Ingresa 13–19 dígitos.
          </span>
        </div>

        <div class="row">
          <label>Nombre en la tarjeta
            <input type="text" formControlName="card_name" placeholder="JOHN DOE" />
          </label>
          <span class="err" *ngIf="form.controls['card_name'].touched && form.controls['card_name'].invalid">
            Obligatorio.
          </span>
        </div>

        <div class="row two">
          <label>Vencimiento (MM/AA)
            <input type="text" formControlName="expiration_date" placeholder="12/27" />
          </label>
          <label>CVV
            <input type="text" inputmode="numeric" formControlName="cvv" placeholder="123" />
          </label>
        </div>
        <span class="err" *ngIf="form.controls['expiration_date'].touched && form.controls['expiration_date'].invalid">
          Formato MM/AA.
        </span>
        <span class="err" *ngIf="form.controls['cvv'].touched && form.controls['cvv'].invalid">
          3–4 dígitos.
        </span>

        <div class="actions">
          <button class="btn primary" type="submit" [disabled]="saving">
            {{ saving ? 'Guardando…' : 'Guardar tarjeta' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</section>
